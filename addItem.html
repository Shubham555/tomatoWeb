<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Tomato - Login Form</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
<script src="https://kit.fontawesome.com/a076d05399.js"></script>
<link href="css/main.css" rel="stylesheet" />
 
</head>
<body>
<div class="container"><br><br>

<!-- Modal HTML -->
			<div class="shadow_card">
                <form action="/examples/actions/confirmation.php" method="post">
					<!--<h1 class="text1">TOMATO</h1>-->
					<img src="img/Logo_Tomato.png" style="width: 300px;">
                    <p class="text label_text" style="margin-top: 0px;margin-bottom: 0px;">Add Item</p>
                 <div class="container">   
                <div class="row">
                    <div class="col-12" style="padding-bottom: 20px;">
                        <div class="form-group">
                            <label for="exampleFormControlFile1">Upload Logo</label>
                            <input type="file" class="form-control-file" id="exampleFormControlFile1">
                          </div>
                    </div>
                    <br><br>
				  <div class="col-xs-4 col-sm-4 col-md-4">
					<div class="form-group"><b>Menu Item</b>
						 <input type="text" id="name" class="form-control">
                    </div>
				  </div> 

				  <div class="col-xs-3 col-sm-3 col-md-3">
					<div class="form-group">
                        <label for="menuOptions">Menu Options</label>
                        <select class="form-control" id="menuOptions">
                          
                        </select>
                    </div>
				</div> 

				<div class="col-xs-5 col-sm-5 col-md-5">
					<div class="form-group"><b>Enter Price</b>
						<input type="number" id="price" class="form-control">
                    </div>
				</div> 
		   </div>
		   
		      <div class="row">
		         <div class="col-xs-4 col-sm-4 col-md-4">
					<div class="form-group"><b>Menu Description</b>
				  <input type="text" class="form-control" id="description">
			      </div>
		        </div> 
			 </div>
			 
			 
 
		<div class="row">
            <div class="col-xs-6 col-sm-6 col-md-6">
                <div class="form-group"><b class="label_text">Select Type</b> <br><br>
                    <input type="radio" name="type" value="veg"  checked="">&nbsp;
                      <label for="self order">Veg</label>
                    <input type="radio" name="type" value="nonveg">&nbsp;
                       <label for="takeaway">Non Veg</label>&nbsp;
                      <input type="radio" name="type" id="vegan" value="vegan">&nbsp;
                        <label for="reservation">Vegan</label>&nbsp;
                </div>
            </div>
	</div>
 
    <div class="row">
        <div class="col-12">
             <b class="label_text">Ingredients Name</b> <br><br>
                
            </div>
            <div class="input-group mb-3 col-6">
                <br>
                <input type="text" id="newIngredient" class="form-control" placeholder="Enter Ingredients Name" aria-label="Recipient's username" aria-describedby="basic-addon2">
                <div class="input-group-append">
                  <span class="input-group-text" onclick="pushIngredient()" id="basic-addon2">Add</span>
                </div>
              </div>
              
        </div>

        <div class="row items">
        </div>
        <div class="form-group">
            <button type="button" onclick="submit_form()" class="btn btn-block">Submit</button>
        </div>        
</div> 
   


</div>
	
	   
</div>
  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-app.js"></script>

  <!-- If you enabled Analytics in your project, add the Firebase SDK for Analytics -->
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-analytics.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.18.0/firebase-storage.js"></script>

  <script type="text/javascript" src="scripts/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>  
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>    
      <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script type="text/javascript" src="scripts/script.js"></script>
  <script type="text/javascript">
        // TODO: Add listener for the ingredients to list new ingredients added elsewhere
        // Check if the User is logged in
        let user, menuOptions, ingredients, submitIngredients = {}, suggestIngredients = [], addedIngredients = [];
        isLoggedIn(function(response) {
            if (response.status === 'Success') {
                user = response.user;
                console.log(user.uid);
                // Get the menu options
                getCategory(user.uid, function(response) {
                    menuOptions = response.items;
                    getIngredients(function(response) {
                        ingredients = response.items;
                        $(function() {
                            // Load the options
                            menuOptions.forEach(function(menuOption) {
                                let option = $('<option></option>').val(menuOption.name).text(menuOption.name);
                                $('select#menuOptions').append(option);
                            });

                            ingredients.forEach(function(ingredient) {
                                suggestIngredients.push(ingredient.name);
                            });

                            $('#newIngredient').autocomplete({
                              source: suggestIngredients
                            });
                        });                        
                    });
                });
            }
        });

        function findIn(addedIngredients, ingredient) {
            addedIngredients.some(function(element, i) {
                console.log(ingredient.toLowerCase(), element.toLowerCase())
                if (ingredient.toLowerCase() === element.toLowerCase()) {
                    return i;
                } else {
                    return -1;
                }
            });
        }

        function pushIngredient() {
            let ingredient = $('#newIngredient').val();
            let index = -1;
            addedIngredients.some(function(element, i) {
                if (ingredient.toLowerCase() === element.toLowerCase()) {
                    // Warning here
                    index = i
                }
            });
            if (index === -1) {
                addedIngredients.push(ingredient);
                let name = $('<div></div>').addClass('col-6 name').text(ingredient);
                let delBtn = $('<div></div>').addClass('col-6 text-right delete').text('Delete');
                let row = $('<div></div>').addClass('row').append(name, delBtn);
                let enclosure = $('<div></div>').addClass('col-4 item').html(row);

                $('.row.items').append(enclosure);
            }
        }

        function submit_form() {
            addedIngredients.forEach(function(ingredient) {
                if (suggestIngredients.includes(ingredient)) {
                    let add = ingredients.find(x => x.name === ingredient);
                    submitIngredients[add.name] = add.is_allergent;
                } else {
                    addedIngredient(ingredient, function(response) {
                        if (response === 'Success') {
                            submitIngredients[ingredient] = false;
                        }
                    });
                }
            });
            console.log(submitIngredients);
            let imageFile = document.querySelector('input[type="file"]').files[0];
            let ext = imageFile.name.split('.').pop();
            let category = $('#menuOptions').val();
            let name = 'menus/' + category + '/' + $('#name').val() + ext;
            storeImage(name, imageFile, function(response) {
                if (response.status === 'Success') {
                    data = {
                        category: category,
                        description: $('#description').val(),
                        image_url: response.url,
                        ingredients: submitIngredients,
                        menu_type: $("input[name='type']:checked").val(),
                        is_vegan: $('input#vegan').is(':checked'),
                        name: $('#name').val(),
                        price: $('#price').val(),
                        timestamp: new Date()
                    }
                    console.log(data);
                    addItem(user.uid, category, data, function(response) {
                        if (response.status === 'Success')
                            console.log("Ohhh yesss");
                    })
                }
            });            
        }
  </script>              
</body>
</html>